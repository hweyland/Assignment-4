---
title: "Juvenile Snowshoe Hares in Bonanza Creek: Exploratory Report"
author: "Hanna Weyland"
date: "11/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(ggbeeswarm)
library(kableExtra)
library(effsize)
library(broom)
library(ggpubr)
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
bonanza_hares <- read.csv(here("data", "bonanza_hares.csv"))
```

### 1. Introduction - DONE 

This report provides an exploratory overview of the counts and sizes of juvenile snowshoe hares (*Lepus americanus*) recorded from 1998 - 2012. Snowshoe hares are an important keystone prey species and experience population fluctuations of 8 to 11 years. From 1999 to 2002, capture-recapture studies of snowshoe hares at 5 locales in the Tanana valley were conducted. This report includes annual juvenile hare trap counts, comparisons between juvenile hare weight by sex, and the relationship between juvenile hare hind foot length and weight. MORE 

### 2. Data and Analysis - DO

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

Snowshoe hare data was collected.... As keystone species in the northern boreal forests,  

"you will explore the counts and sizes of juvenile snowshoe hares recorded from 1998 - 2012."

"Despite intense responses of both vegetation and predators to changes in hare densities, landscape-scale comparisons of hare populations in Alaska have been limited to qualitative descriptions. We conducted capture-recapture studies of snowshoe hares at 5 locales in the Tanana valley, from Tok in the east to Clear in the west from 1999 to 2002."


Snowshoe hare data was collected using capture-recapture technique at 5 locales in the Tanana valley were conducted from 1999 to 2002. Over the 15 years, 3197 hares were caught 
3000 hares caught for 15 years 
tests you did 

### 3. Exploratory Findings 

#### a. Annual juvenile hare trap counts

```{r basic_flipper_plot, fig.align = "center", echo = FALSE, message = FALSE, warning = FALSE}
#Create a new data set 
hare_data <- bonanza_hares %>% 
  filter(age == "j") %>% 
  mutate(date_new = mdy(date)) %>% 
  mutate(year_new = year(date_new)) %>% 
  count(year_new)

ggplot(data = hare_data, aes(x=year_new, y = n)) +
  geom_col(fill = "lightblue3") +
  labs(x="Year", y = "Nunber of Juvenile Hare Trappings", title = "Number of Juvenile Hare Trappings from 1999-2012") +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 11)) + 
  scale_y_continuous(breaks = scales::pretty_breaks(n = 7)) +
  theme_light()

```
**Figure 1.** Juvenile hare trap counts from 1999 to 2012. Hare trap counts show a general decrease over time where year 1999 had the highest trap count. Data: Kielland et al, 2017.

The overall general trend of the number of juvenile hare trappings for years 1999-2012 decreased over time. The distribution is skewed right. The minimum number of hares trapped at a given time was 2 while the maximum number was 126. The mean for this distribution was 31.5 while the median was 18.5. The standard deviation was 35.88. WHAT WOULD YOU DO MOVING FORWARD TO STANDARDIZE HARE POPULATION FUTURE ANALYSIS. - chose a set number of days to analyze throughout the year --> lower chance of skewing data during different seasons too 
first year had 126 hares 


**Table 1.** Descriptive statistics (mean, median, standard deviation, minimum, maximum and sample size) for female and male juvenile hares. Data: Kielland et al, 2017.  
```{r, warning=FALSE, messages = FALSE, echo=FALSE}
hare_stats <- hare_data %>% 
  summarize(
    mean_count = mean(n),
    median_count = median(n),
    sd_count = sd(n),
    min_count = min(n),
    max_count = max(n),
    sample_size = n())
kbl(hare_stats)%>% 
kable_styling(bootstrap_options = "striped", full_width = F)

```
Table 1. Descriptive statistics (mean, median, standard deviation, minimum, maximum and sample size) for female and male juvenile hares. Data: Kielland et al, 2017.


```{r}
#Create new columns and change names of column headers to a clean format
hare_weights <- bonanza_hares %>% 
  filter(age == "j") %>%
  mutate(date_new = mdy(date)) %>% 
  mutate(year_new = year(date_new)) %>% 
  mutate(grid = 
           case_when(
             grid == "bonrip" ~ "Bonrip",
             grid == "bonbs" ~ "Bonbs",
             grid == "bonmat" ~ "Bonmat")) %>% 
   mutate(sex = 
           case_when(
             sex == "f" ~ "Female",
             sex == "m" ~ "Male")) %>% 
  select(sex, weight, grid)
```

```{r}
#Create a boxplot  
ggplot(data = hare_weights, aes(x = sex, y = weight, fill = sex)) +
  geom_boxplot() + 
  scale_fill_brewer(palette ="Blues") +
  facet_wrap(~grid) +
  stat_summary(fun=mean, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  labs(x= "Sex", y = "Weight (g)", Title = "Juvenile Hare Weights by Sex and Site", fill = "Sex")
```

> EDIT

**Figure 2.** boxplot of weights of HARES at three difffernt sites. endpoints are 25 and 75 percentile. line is the median and the dot is the mean. other dots are are outliers 
NA accounts for individuals that were not sexed at the time of the study DATA: HERE 


Takeaways 
median weights at black spruce



**Table 1.** Summary statistics for female and male juvenile hares
```{r}
hare_summary <- hare_weights[!is.na(hare_weights$weight),] %>% 
  group_by(sex) %>% 
  summarize(
    mean = mean(weight),
    sd = sd(weight), 
    sample_size = n())

kbl(hare_summary) %>% 
kable_styling(bootstrap_options = "striped", full_width = F)
```

```{r}
#Find the means for male and female to fidn the mean difference
male_mean <- mean(hares_m)
female_mean <- mean(hares_f)

#Find the effect size/Cohen's d test and ttest

hares_f <- hare_weights %>% 
  filter(sex == "Female") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)

hares_m <- hare_weights %>% 
  filter(sex == "Male") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)
  
hist(hares_f) # Looks normal
qqnorm(hares_m) # Relatively linear
hist(hares_f) # Looks normal
qqnorm(hares_m) # Relatively linear

#Run ttest (distribution is normal)
hares_ttest <- t.test(hares_f, hares_m)
hares_ttest

#Run cohen.d test
cohen.d(hares_f, hares_m)
```


```{r}
#Plot a histogram comparing weight by sex
ggplot(data=hare_weights, aes(x=weight, fill = sex)) +
  geom_histogram(aes(color = sex, bins = 60)) +
  scale_color_manual(values=c("lightcyan3", "lightskyblue4"), na.value = "gray55") +
  scale_fill_manual(values=c("lightcyan2", "lightskyblue3"), na.value = "gray55") +
  facet_wrap(~sex) +
    labs(title = "Juvenile Male and Female Snowshoe Hare Weight Distribution", caption = "CAPTION", 
         x = "Weight (g)", y = "Number of Hares") + 
  scale_y_continuous(breaks = scales::pretty_breaks(n = 8)) +
    theme_bw()

#Plot a qqplot comparing weight by sex
ggplot(data=hare_weights, aes(sample=weight)) +
  geom_qq(aes(color = sex), binwidth = 50) +
  facet_wrap(~sex) +
  scale_color_manual(values=c("lightcyan3", "lightskyblue4"), na.value = "gray55") +
  scale_fill_manual(values=c("lightcyan3", "lightskyblue4"), na.value = "gray55") +
  labs(title = "TITLE", caption = "CAPTION") + 
  theme_bw()
```

```{r}
#Create a data 
hares_ft_weight <- bonanza_hares %>% 
  filter(age == "j") %>% 
  mutate(sex = 
           case_when(
             sex == "f" ~ "Female",
             sex == "m" ~ "Male")) %>% 
  select(sex, weight, hindft)

ggplot(data=hares_ft_weight, aes(x=weight, y=hindft, color = sex))+
  geom_point()+
  facet_wrap(~sex) +
  labs(tile = "Juvenile Snowshoe Hare Hind Foot Length verus Weight", 
       x ="Weight (g)", y = "Hind Foot Length (mm)", caption = "CAPTION") +
  scale_color_manual(values=c("lightcyan3", "lightskyblue4"), na.value = "gray55") +
  theme_bw()

```

```{r}
#Run a linear regression model
hares_lm <- lm(hindft ~ weight, data = hares_ft_weight)
summary(hares_lm)

hares_lm_tidy <- broom::tidy(hares_lm)

# Get the intercept: 
hares_int <- hares_lm_tidy$estimate[1]
hares_int

# Then get the   coefficient:
hares_coef <- hares_lm_tidy$estimate[2]
hares_coef

# Metrics at a glance: 
hares_lm_out <- broom::glance(hares_lm)
hares_lm_out

plot(hares_lm)
```

```{r}
ggplot(data = hares_ft_weight, aes(x = weight, y = hindft)) +
  geom_point(size = 2) +
  geom_smooth(method = "lm",
              color = "red",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) +
  theme_light() +
  ggpubr::stat_regline_equation(label.x = 180, label.y = 200) +
   labs(x ="Weight (g)", y = "Hind Foot Length (mm)", caption = "CAPTION")

```


```{r}
hares_cor <- cor.test(hares_ft_weight$weight, hares_ft_weight$hindft)
hares_cor
```
moderatley positive correlation 
reject Null 

relatively linear 

### Summary: Include a very short summary describing your main findings from your juvenile hares exploration (bulletpoints are fine)
Overall, 

### Citations 

Data citation: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14



