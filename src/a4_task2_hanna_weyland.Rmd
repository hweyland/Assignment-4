---
title: "Juvenile Snowshoe Hares in Bonanza Creek: Exploratory Report"
author: "Hanna Weyland"
date: "11/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(ggbeeswarm)
library(kableExtra)
library(effsize)
library(broom)
library(ggpubr)
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
bonanza_hares <- read.csv(here("data", "bonanza_hares.csv"))
```

### 1. Introduction - FIX 

This report provides an exploratory overview of the counts and sizes of juvenile snowshoe hares (*Lepus americanus*) recorded from 1998 - 2012 (Kielland et al, 2017). Snowshoe hares are an important keystone prey species and experience population fluctuations of 8 to 11 years. 

From 1999 to 2002, capture-recapture studies of snowshoe hares at 5 locales in the Tanana valley were conducted. 

This report includes annual juvenile hare trap counts, comparisons between juvenile hare weight by sex, and the relationship between juvenile hare hind foot length and weight. MORE 

### 2. Data and Analysis

Snowshoe hare data was collected using capture-recapture technique at 5 locales in the Tanana valley (Kielland et al, 2017). Data was collected and made available by Dr. Knut Kielland, Stuart F. Chapin, and Roger W. Ruess along with colleagues at the Bonanza Creek Long Term Ecological Research (LTER) network site at the University of Alaska Fairbanks Institute of Arctic Biology (Kielland et al, 2017). Over the 15 years this study was conducted, 3197 hares were trapped (Kielland et al, 2017). Following exploratory data visualization, weight of female and male juvenile hares are compared using a two-sample t-test with a significance level (α) of 0.05. Differences between male and female hares are described by Cohen’s d effect size. The relationship between weight and hind foot length is explored through a linear regression model. All analyses are in R version 4.0.2 using RStudio version 1.3.1056.

### 3. Exploratory Findings 

#### a. Annual juvenile hare trap counts

```{r, fig.align = "center", echo = FALSE, message = FALSE, warning = FALSE}

#Create a new data set for juvenile hares
hare_data <- bonanza_hares %>% 
  filter(age == "j") %>% 
  mutate(date_new = mdy(date)) %>% 
  mutate(year_new = year(date_new)) %>% 
  count(year_new)

#Create a bar graph of annual juvenile hare trap counts from 1999-2012
ggplot(data = hare_data, aes(x=year_new, y = n)) +
  geom_col(fill = "lightblue3") +
  labs(x="Year", y = "Nunber of Juvenile Hare Trappings", title = "Number of Juvenile Hare Trappings from 1999-2012") +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 11)) + 
  scale_y_continuous(breaks = scales::pretty_breaks(n = 7)) +
  theme_light()
```
**Figure 1.** Juvenile male and female hare trap counts from 1999 to 2012. Hare trap counts show a general decrease over time where year 1999 had the highest hare trap count. Data: Kielland et al, 2017.


***Main Takeaways***

The overall general trend of the number of juvenile hare trappings for years 1999-2012 decreased over time. The first year (1999) had the greatest number of counts at 126 while 2010 had the lowest number of counts at 2. In 2002 and 2009, hares were trapped during these years however, these hares were never assigned an age and thus were not able to be counted for these years. The mean for this distribution was 31.5 while the median was 18.5. The standard deviation was 35.88. In order to better standardize this data, hare trapping should occur for a set number of days during the year during different seasons. This would lower or eliminate the chance of skewed data if each year had a certain amount of days that hare trapping occurred.  

```{r, warning=FALSE, messages = FALSE, echo=FALSE, include = FALSE}

#Summary statistics for juvenile male and female hares (based on data above) - CHECK THIS 
hare_stats <- hare_data %>% 
  summarize(
    mean_count = mean(n),
    median_count = median(n),
    sd_count = sd(n),
    min_count = min(n),
    max_count = max(n),
    sample_size = n())
kbl(hare_stats)%>% 
kable_styling(bootstrap_options = "striped", full_width = F)
```


#### b. Juvenile hare weights by sex and site 
```{r, warning=FALSE, messages = FALSE, echo=FALSE}
#Create new data set for hare weights filtered by age and site 
hare_weights <- bonanza_hares %>% 
  filter(age == "j") %>%
  mutate(date_new = mdy(date)) %>% 
  mutate(year_new = year(date_new)) %>% 
  mutate(grid = 
           case_when(
             grid == "bonrip" ~ "Bonanza Riparian",
             grid == "bonbs" ~ "Bonanza Black Spruce",
             grid == "bonmat" ~ "Bonanza Mature")) %>% 
   mutate(sex = 
           case_when(
             sex == "f" ~ "Female",
             sex == "m" ~ "Male")) %>% 
  select(sex, weight, grid)
```


```{r, warning=FALSE, messages = FALSE, echo = FALSE, fig.align = "center"}
#Create a boxplot for hare weights by sex and site including summary statistics
ggplot(data = hare_weights, aes(x = sex, y = weight, fill = sex)) +
  geom_boxplot() + 
  scale_fill_brewer(palette ="Blues") +
  facet_wrap(~grid) +
  stat_summary(fun=mean, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  labs(x= "Sex", y = "Weight (g)", title = "Juvenile Hare Weights by Sex and Site", fill = "Sex") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 7)) +
  theme_bw()
```

**Figure 2.** Boxplot of the juvenile hare weights (g) compared by sex at three different sites (Bonanza Black Spruce, Bonanza Mature, and Bonanza Riparian). Light blue plots indicate female observations, dark blue plots represents male observations and transparent plots indicate "NA" or not recorded values. The endpoints on the boxplot indicate the 25^th^ and 75^th^ percentile values. The black lines within the box represents the median and the mean value is represented by a black dot. Data: Kielland et al, 2017.    


***Main Takeaways***

TO DO
median weights at black spruce


#### c. Juvenile weight comparison of male & female snowshoe hares 

**Table 1.** Summary statistics (mean, standard deviation, and sample size) for juvenile female and male hare weights. Data: Kielland et al, 2017. 
```{r, warning=FALSE, messages = FALSE, echo=FALSE}
#Juvenile hare weight comparison and descriptive statistics
hare_summary <- hare_weights[!is.na(hare_weights$weight),] %>% 
  group_by(sex) %>% 
  summarize(
    mean = round(mean(weight, na.rm = TRUE),2), 
    sd = round(sd(weight, na.rm = TRUE),2),
    sample_size = n())

kbl(hare_summary) %>% 
kable_styling(bootstrap_options = "striped", full_width = F)
```

```{r, warning=FALSE, messages = FALSE, include = FALSE}
#T-test code: 

# Pull vectors of weights for female and male juvenile hares (filter NA values)
hares_f <- hare_weights %>% 
  filter(sex == "Female") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)

hares_m <- hare_weights %>% 
  filter(sex == "Male") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)

# Plot histograms & qq-plots to check assumptions
hist(hares_f) # Looks normal- maybe slightly right skewed
qqnorm(hares_f) # Pretty linear
hist(hares_m) # Looks relatively normal
qqnorm(hares_m) # Relatively linear

#Everything looks relatively normal --> run ttest for mean comparison 

#Run ttest
hares_ttest <- t.test(hares_f, hares_m)

# Get the tidy model results to call outputs in-line: 
hares_ttest_tidy <- tidy(hares_ttest)

# Get the means & SDs for each: 
male_mean <- mean(hares_m)
female_mean <- mean(hares_f)
male_sd <- sd(hares_m)
female_sd <- sd(hares_f)

#Get effect size (cohen'd )
hares_effsize <- cohen.d(hares_f, hares_m)
```
***Main Takeaways***
Mean weights (in grams) were compared for male and female juvenile snowshoe hares. Male juvenile hares were found to be heavier than female juvenile hares (`r hare_summary[2,2]` $\pm$ `r hare_summary[2,3]` and `r hare_summary[1,2]` $\pm$ `r hare_summary[1,3]`). The absolute mean difference was found to be 90.47. The difference in means was found to be significant (Welch's two-sample t-test: (p = 0.007, ($\alpha$) < 0.05) and the effect is small (Cohen's *d* = `r round(hares_effsize$estimate,2)`). Data: Kielland et al, 2017. 



#### d. Relationship between juvenile weight & hind foot length

```{r, include = FALSE}
#Create a data 
hares_ft_weight <- bonanza_hares %>% 
  filter(age == "j") %>% 
  mutate(sex = 
           case_when(
             sex == "f" ~ "Female",
             sex == "m" ~ "Male")) %>% 
  select(sex, weight, hindft)

#Run a linear regression model
hares_lm <- lm(hindft ~ weight, data = hares_ft_weight)
summary(hares_lm)

hares_lm_tidy <- broom::tidy(hares_lm)

# Get the intercept: 
hares_int <- hares_lm_tidy$estimate[1]
hares_int

# Then get the   coefficient:
hares_coef <- hares_lm_tidy$estimate[2]
hares_coef

# Metrics at a glance: 
hares_lm_out <- broom::glance(hares_lm)
hares_lm_out

plot(hares_lm)

# Get Pearson's r correlation
hares_cor <- cor.test(hares_ft_weight$weight, hares_ft_weight$hindft)
hares_cor
```

```{r, warning=FALSE, messages = FALSE, echo = FALSE, fig.align = "center"}
#Create a graph displaying hind foot length vs weight for juvenile hares
ggplot(data = hares_ft_weight, aes(x=weight, y=hindft, color = sex))+
  geom_point(aes(shape=sex, color=sex), size=2) +
  geom_smooth(method = "lm",
              color = "black",
              size = 1) +
  scale_shape_manual(values=c(16, 15), na.value = 17,
                     name = "Sex") +
  scale_color_manual(values=c("lightcyan3", "lightskyblue4"), na.value = "gray40",
                     name = "Sex") +
  scale_x_continuous(name = "Weight (g)", limits=c(0, 1600)) +
  scale_y_continuous(name = "Hind Foot Length (mm)", limits=c(0, 170)) +
  labs(title = "Juvenile Snowshoe Hare Hind Foot Length verus Weight") +
  theme_bw()
```
***Figure 3.*** Relationship between juvenile female and male snowshoe hare weight (g) and hind foot length (mm). Points indicate individual hare measurements (female = light blue circles; males = dark blue squares and "NA" or not recorded = gray triangles). Lin

looking at hind foot length vs weight? 

Data: Kielland et al, 2017.

Relationship between flipper length (mm) and body mass (g) for the three penguin species. Points indicate individual penguin measurements (Adélie = gold circles; chinstrap = teal triangles; gentoo = coral diamonds). Linear model summary: $\beta$~1~ = `r round(penguin_lm_tidy$estimate[2], 2)` g mm^-1^, p < 0.001, R^2^ = `r round(penguin_lm_glance$r.squared,2)`, Pearson's *r* = `r round(penguin_cor_tidy$estimate,2)`). Data: Gorman et al. (2014).

moderatley positive correlation 
reject Null 

relatively linear 

### Summary: Include a very short summary describing your main findings from your juvenile hares exploration (bulletpoints are fine)
Overall, 

### Citations 

Data citation: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14



